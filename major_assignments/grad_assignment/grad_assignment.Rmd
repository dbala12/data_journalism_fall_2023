---
title: "Graduate Assignment: Violent Crime and Property Crime in Maryland Counties Analysis"
author: "Daranee Balachandar"
date: "2023-11-26"
output: html_notebook
---
#Violent Crime and Property Crime in Maryland Municipalities Analysis

For this data analysis project, I will be working with the Violent Crime & Property Crime by County: 1975 to Present Data (2020) <https://opendata.maryland.gov/Public-Safety/Violent-Crime-Property-Crime-by-County-1975-to-Pre/jwfa-fdxs>. 

According to the Maryland State Open Data Portal web page, <https://opendata.maryland.gov/Public-Safety/Violent-Crime-Property-Crime-by-County-1975-to-Pre/jwfa-fdxs> the Violent Crime & Property Crime by Municipality data is provided by the Maryland Statistical Analysis Center in the Governor's Office of Crime Control and Prevention. The center receives the data from the Maryland State Police's annual Uniform Crime Reports, a state program started in Maryland in 1975. The FBI assists the development of this program in order to make it compatible with the national version and the program involves uniform classification, compilation, review and analysis of crime statistics by all state law enforcement agencies. 

The Maryland Department of State Police is responsible for the collection and dissemination of the UCR data in accordance to the Public Safety Article, Section 2, Subsection 307 and 308 in the Annotated Code of Maryland. The owner of the violent and property crime data set is the open data owner and its dissemination on the Open Data Portal is under Maryland's Open Data Program. This data set was created on February 2, 2016 and was last updated on May 23, 2023.

As the timeframe for the data set is between 1975 to 2020, I plan to explore the violent and property crime trends based on major events that have happened from 2000 to 2020. Major events may include environmental and climate changes as well as natural disasters, the initial parts of the COVID-19 pandemic, the Freddie Gray and George Floyd protests in Maryland.

## Data set up

Load libraries
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
options(scipen=999)
# install.packages("ggrepel")
# install.packages('ggthemes')
library(tidyverse)
library(lubridate)
library(janitor)
library(ggthemes)
library(tidycensus)
library(ggplot2)
library(ggrepel)
library(tigris)
```

Load Data

```{r}
#Load data 
crime_data_1975_2020 <- read_csv("data/Violent_Crime___Property_Crime_by_County__1975_to_Present.csv") 

#Data summary
summary(crime_data_1975_2020)
```
## Data Cleaning

```{r}
#Clean column names and change year column to a character column
crime_data_1975_2020 <- crime_data_1975_2020 |> 
  clean_names() |> 
  mutate(year = as.character(year))

#Rename jurisdiction column to county
crime_data_1975_2020 <- crime_data_1975_2020 |> 
  rename(county = jurisdiction)
```

## Checking aggregates and data limitations in the data set

What does each row represent?
What is the chronological and geographic scope of this data?
If this data contains aggregates (totals), can you find itemized data that those totals are derived from? Do the totals match your own calculations using the itemized data?

There are **1104 rows** and **38 columns** of data, which includes columns of data on the county in which the crimes took place, the year, the population of the county at that year and the types of crime cases such as rape, robbery, larceny theft, motor vehicle theft and more. There are also columns that calculate the grand total of crimes in the county in a certain year, percentage change of total crime for the year as compared to the previous year, the violent crime total, the percentage of violent crime, property crime totals, property crime percentage, violent crime percentage change, property crime percentage change, the overall crime rate per 100,000 people, the overall percent change per 100,000 people as well as the rate of different types of crimes per 100,000 people. Each row of the data is based on the yearly crime data in each county. 

Firstly, the FBI classifies murder, rape, robbery and aggravated assault under violent crime <https://ucr.fbi.gov/crime-in-the-u.s/2019/crime-in-the-u.s.-2019/topic-pages/violent-crime.pdf>. Meanwhile, property crime includes offences such as burglary (breaking and entering, B&E), larceny-theft and motor vehicle theft. This data set does not include data on carjacking cases or arson cases. The reason being that the UCR did not record carjacking cases separately or distinctively until 2022 <https://www.umpd.umd.edu/stats/ucr/legacy_ucr.cfm>. Meanwhile, the FBI clarified that there is only limited data available for arson.

According to the title of the data set, it is meant to consist of data recorded from 1975 to present, which is 2020. This is kind of a limitation as the data is not current. However, this data project plans to explore how violent crime and property crime in Maryland is impacted by major national and state incidents. 

Another limitation about this data set is the geographic scope of this data. This data is recorded based on crimes reported in in counties in Maryland and does not record data according to zip codes. The lack of zip codes may limit the exploration down to counties rather than the neighborhoods in which the crimes had taken place. 

This data set comes with aggregate data columns such as grand total crimes, percent change of crimes from the year before, violent crime total, violent crime percentage, property crime total and property crime percentage. I will be checking this.

```{r}
#Calculate grand total of crimes
crime_data_1975_2020 |> 
  group_by(county, year) |> 
  summarise(crime_total=murder+rape+robbery+agg_assault+b_e+larceny_theft+m_v_theft)
```

```{r}
#Calculate total of violent crimes by year
crime_data_1975_2020 |> 
  group_by(county, year) |> 
  mutate(
   violent_total = murder+rape+robbery+agg_assault) |> 
   select(county, year, violent_crime_total, violent_total)
```

```{r}
#Calculate total of property crimes by year
crime_data_1975_2020 |> 
  group_by(county, year) |> 
  mutate(
    property_total = b_e+larceny_theft+m_v_theft) |> 
    select(county, year, property_crime_totals, property_total)
```
```{r}
#Calculate violent crime percent per county and per year
crime_data_1975_2020 |> 
  group_by(county, year) |>
  mutate(
    violent_percent = (violent_crime_total/grand_total)*100) |> 
    select(county, year, violent_crime_percent, violent_percent)
```

```{r}
#Calculate property crime percent per county and per year
crime_data_1975_2020 |> 
  group_by(county, year) |>
  mutate(
    property_percent = (property_crime_totals/grand_total)*100) |> 
  select(county, year, property_crime_percent, property_percent)
```

In order to calculate the per capita data per year, I will be using the population data provided in the dataset.
```{r}
#Calculate violent crime per capita per year and county
crime_data_1975_2020 |> 
  group_by(county,year) |> 
  mutate(
    violent_crime_rate = (violent_crime_total/population)*100000
  ) |> 
  select(county, year, population, violent_crime_rate_per_100_000_people, violent_crime_rate)
```

```{r}
#Calculate property crime per capita per year and county
crime_data_1975_2020 |> 
  group_by(county,year) |> 
  mutate(
    property_crime_rate = (property_crime_totals/population)*100000
  ) |> 
  select(county, year, population, property_crime_rate_per_100_000_people, property_crime_rate)
```

## Data Exploration

For this section, I will exploring the violent and property crime rates iin each county for the year 2020 and 
Checking the violent crime rate per 100,000 people in each county in 2020 year by year using the ACS 2020 data. 

```{r}
#Load ACS5 variables
acs5 <- load_variables(2020, "acs5", cache = TRUE)

acs5
```
```{r}
md_county_population <- get_acs(geography = "county",
              variables = c(population = "B01001_001"),
              year = 2020,
              state = "MD",
              geometry = TRUE)

md_county_population
```

```{r}
#Filter the crime rate for each county in 2020
county_crime_rate_2020 <- crime_data_1975_2020 |> 
  filter(year == 2020)
```

```{r}
#Prep MD county population dataset for joining
md_county_population <- md_county_population |> 
  rename(county = NAME) |>
  mutate(county = str_to_title(str_remove_all(county,", Maryland"))) |>
  mutate(county = str_trim(county,side="both")) |>
  rename(population = estimate) |>
  select(county, population, geometry)
```

```{r}
#Join MD county population with county crime rate 2020
md_county_crime_rate <- md_county_population |> 
  left_join(county_crime_rate_2020, join_by(county))
```

```{r}
counties <- counties()

glimpse(counties)
```
```{r}
md_counties <- counties |>
  filter(STATEFP == "24")
```


```{r}
#Plot a map of the crime rate in 2020
county_centroids <- st_centroid(md_counties)
county_centroids_df <- as.data.frame(st_coordinates(county_centroids))
county_centroids_df$NAME <- county_centroids$NAME

ggplot() +
  geom_sf(data=md_county_crime_rate, aes(fill=overall_crime_rate_per_100_000_people)) +
  geom_text(aes(x = X, y = Y, label = NAME), data = county_centroids_df, size = 3, check_overlap = TRUE) +
  theme_minimal()
```
I will also be exploring the data set by creating a new data set based on total of every crime in each county.
```{r}
#Calculate total of each type of crime for each county from 1975 to 2020
county_total_crimes <- crime_data_1975_2020 |> 
  group_by(county) |> 
  summarise(
    total_murder = sum(murder),
    total_rape = sum(rape),
    total_robbery = sum(robbery),
    total_agg_assault = sum(agg_assault),
    total_b_e = sum(b_e),
    total_larceny_theft = sum(larceny_theft),
    total_m_v_theft = sum(m_v_theft)
  )
```

```{r}
#Create total of violent crimes
county_total_crimes <- county_total_crimes |> 
   group_by(county) |> 
   mutate(
     total_violent_crimes = total_murder+total_rape+total_robbery+total_agg_assault
   ) 

#Create total of property crimes 
county_total_crimes <- county_total_crimes |> 
   group_by(county) |> 
   mutate(
     total_property_crimes = total_b_e+total_larceny_theft+total_m_v_theft
   ) 

#Create total crimes 
county_total_crimes <- county_total_crimes |> 
   group_by(county) |> 
   mutate(
     total_crimes = total_b_e+total_larceny_theft+total_m_v_theft+total_murder+total_rape+total_robbery+total_agg_assault
   ) 
```

Write out the csv of the total crimes from 1975 to 2020 by county.
```{r}
#Write out csv for county_total_crimes
write.csv(county_total_crimes, "county_total_crimes.csv", row.names = TRUE)
```

Using the csv of the county_total_crimes dataset, a map was created using datawrapper to show the counties that had the overall highest crime reports in 35 years.

Here is the link for the map <https://www.datawrapper.de/_/9MwH0/>

Next, with the knowledge that Baltimore City has the highest overall crime cases, here is a closer look at the total violent crimes in Baltimore City between 2016 and 2020.

```{r}
baltimore_crime_rate_2016_2020 <- crime_data_1975_2020 |> 
  filter(year >= 2016 , year <= 2020) |> 
  filter(str_detect(county, "Baltimore City")) |> 
  select(county, year, violent_crime_rate_per_100_000_people, property_crime_rate_per_100_000_people, overall_crime_rate_per_100_000_people)
```


```{r}
#Create a bar graph for Baltimore City Violent Crime Rate
baltimore_crime_rate_2016_2020 |> 
   ggplot() +
  geom_bar(
    aes(
      x = year,
      weight = violent_crime_rate_per_100_000_people,
      fill = "skyblue")) +
  labs(
    x = "Year",
    y = "Violent Crime Rate",
    title = "Baltimore City Violent Crime Rate 2016 to 2020") +
  theme_minimal () +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```
Then, the property crime rate in Baltimore City from 2016 to 2020.

```{r}
#Create a bar graph for Baltimore City Property Crime Rate
baltimore_crime_rate_2016_2020 |> 
   ggplot() +
  geom_bar(
    aes(
      x = year,
      weight = property_crime_rate_per_100_000_people,
      fill = "skyblue")) +
  labs(
    x = "Year",
    y = "Property Crime Rate",
    title = "Baltimore City Property Crime Rate 2016 to 2020") +
  theme_minimal () +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```
The next step is to identify the top three types of crimes (violent and/or property crimes) that are most prevalent statewide in 2018, 2019 and 2020.

```{r}
#Calculate the total crimes statewide by year
statewide_crime_totals <- crime_data_1975_2020 |> 
  group_by(year) |> 
  summarize(total_murders = sum(murder), total_rape = sum(rape), total_robbery = sum(robbery),   total_agg_assault = sum(agg_assault), total_b_e = sum(b_e), total_larceny_theft = sum(larceny_theft), total_m_v_theft = sum(m_v_theft)) |> 
  filter(year >= 2018) |> 
  pivot_longer(cols=-year, names_to='category', values_to = 'crimes')

#Create a bar graph of total crimes statewide from 2018 to 2020
statewide_crime_totals |>
  ggplot() +
  geom_bar(aes(x=year, weight=crimes, fill=category)) +
  coord_flip()

```
```{r}
#Calculate the total crimes statewide by year
statewide_crime_totals <- crime_data_1975_2020 |> 
  group_by(year) |> 
  summarize(total_murders = sum(murder), total_rape = sum(rape), total_robbery = sum(robbery),   total_agg_assault = sum(agg_assault), total_b_e = sum(b_e), total_larceny_theft = sum(larceny_theft), total_m_v_theft = sum(m_v_theft), total_violent_crimes = sum(violent_crime_total), total_property_crimes = sum(property_crime_totals)) |> 
  filter(year >= 2018) |> 
  pivot_longer(cols=-year, names_to='category', values_to = 'crimes')

#Create a bar graph of total crimes statewide from 2018 to 2020
statewide_crime_totals |>
  ggplot() +
  geom_bar(aes(x=year, weight=crimes, fill=category)) +
  coord_flip()
```

##Question 1
Was there a statewide surge or decline in violent and property crime in 2020 as compared to 2019 and 2018? 

```{r}
#Calculate top three crimes statewide in 2018
crime_2018_2019_2020 <- statewide_crime_totals |> 
  filter(year == 2018 | year == 2019 | year == 2020) |> 
  select(year, total_violent_crimes, total_property_crimes)
```

```{r}
#Load ACS5 variables for 2020
acs5 <- load_variables(2020, "acs5", cache = TRUE)

acs5
```


##Question 2

Motor vehicle thefts have been prevalent in Maryland, based on reports in the last 2 years. Is this trend new in the 2020's or was there any indication of the trend rising from 2018 to 2020?

```{r}
mv_crime_2017_2020 <- crime_data_1975_2020 |> 
  filter(year == 2018 | year == 2019 | year == 2020) |> 
  select(county, year, population, m_v_theft)
  
```

##Question 3
In 2023, there were reports that motor vehicle thefts and carjackings were mostly committed by juveniles. With this information, compare motor vehicle thefts between areas with high 18 years and over population and high 18 years and under population in 2018 and 2019.

```{r}

```



## Memo

Based on the data exploration, 



